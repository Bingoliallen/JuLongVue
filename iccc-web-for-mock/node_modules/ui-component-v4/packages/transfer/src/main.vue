<template>
  <div class="dg-transfer">
    <!-- 树形穿梭框 -->
    <template v-if="type === 'tree'">
      <transfer-tree
        :value="value"
        :data="dataSource"
        v-bind="$attrs"
        v-on="$listeners"
      >
        <div
          v-if="$slots['left-footer']"
          class="transfer-footer"
          slot="left-footer"
        >
          <slot name="left-footer"></slot>
        </div>
        <div
          v-if="$slots['right-footer']"
          class="transfer-footer"
          slot="right-footer"
        >
          <slot name="right-footer"></slot>
        </div>
      </transfer-tree>
    </template>

    <!--表格穿梭框-->
    <template v-else-if="type === 'table'">
      <transfer-table
        :value="value"
        :data="dataSource"
        v-bind="$attrs"
        v-on="$listeners"
      >
        <div
          v-if="$slots['left-footer']"
          class="transfer-footer"
          slot="left-footer"
        >
          <slot name="left-footer"></slot>
        </div>
        <div
          v-if="$slots['right-footer']"
          class="transfer-footer"
          slot="right-footer"
        >
          <slot name="right-footer"></slot>
        </div>
      </transfer-table>
    </template>

    <!-- 默认穿梭框 -->
    <template v-else>
      <div>
        <el-transfer
          :value="value"
          :props="defaultProps"
          :data="dataSource"
          v-bind="$attrs"
          v-on="$listeners"
        >
          <span slot-scope="{ option }">
            <slot 
              name="content-area" 
              :option="option">{{ option[defaultProps.label] }}
            </slot>
          </span>
          <div
            v-if="$slots['left-footer']"
            class="transfer-footer"
            slot="left-footer"
          >
            <slot name="left-footer"></slot>
          </div>
          <div
            v-if="$slots['right-footer']"
            class="transfer-footer"
            slot="right-footer"
          >
            <slot name="right-footer"></slot>
          </div>
        </el-transfer>
      </div>
    </template>
  </div>
</template>

<script>
import TransferTree from './transfer-tree';
import TransferTable from './transfer-table';

export default {
    name: 'DgTransfer',

    components: {
        TransferTable,
        TransferTree
    },

    props: {
        // 默认选中值
        value: {
            type: Array,
            default() {
                return [];
            }
        },
        // 选项配置数据
        data: {
            type: Array,
            default() {
                return [];
            }
        },
        // 支持的类型 可选项为 "tree"
        type: {
            type: String,
            default: ''
        }
    },

    watch: {
        data: {
            deep: true,
            immediate: true,
            handler(val) {
                this.dataSource = val;
            }
        }
    },

    computed: {
        defaultProps() {
            const { key, label, disabled } = this.$attrs.props || {};
            const valueName = this.$attrs['key-name'] || this.$attrs['value-name'] || key || 'key';
            const labelName = this.$attrs['label-name'] || label || 'label';
            const disabledName = this.$attrs['disabled-name'] || disabled || 'disabled';
            return {
                key: valueName,
                label: labelName,
                disabled: disabledName
            };
        }
    },

    data() {
        return {
            dataSource: []
        };
    }
};
</script>
