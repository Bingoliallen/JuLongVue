<template>
  <el-cascader
    class="dg-cascader"
    :props="defaultProp"
    :options="itemsWithDisabled"
    v-model="model"
    v-bind="$attrs"
    v-on="listeners"
  ></el-cascader>
</template>

<script>
import { Cascader as ElCascader } from 'element-ui';
import { filterObj } from 'main/dg-utils/shear.js';
import { str2arr, data2type } from 'main/dg-utils/data-convert.js';
import ItemsWithDisabled from 'main/dg-mixins/itemsWithDisabled.js';

export default {
    name: 'DgCascader',

    mixins: [ItemsWithDisabled],

    components: {
        ElCascader
    },

    props: {
        value: [String, Array],
        options: Array,
        props: Object
    },

    watch: {
        options(val) {
            this.dataSource = val;
        }
    },

    data() {
        const { data, options } = this;
        return {
            dataSource: data.length ? data : options
        };
    },

    computed: {
        model: {
            get() {
                const { value, seq, dataSource, defaultProp } = this;
                return str2arr(value, seq, true, dataSource, defaultProp.value);
            },
            set(val) {
                const { outputFormat, seq } = this;
                this.$emit('input', data2type(val, outputFormat, seq));
                this.$emit('change', val);
            }
        },

        /* 创建原因：
            input 触发两次且值与 output-format 不同
            change 触发两次
        */
        listeners() {
            return filterObj(this.$listeners, ['input', 'change']);
        }
    }
};
</script>
