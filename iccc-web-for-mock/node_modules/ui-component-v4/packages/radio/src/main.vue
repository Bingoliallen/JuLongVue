<template>
    <label
        class="el-radio dg-radio"
        :class="[
            border && radioSize ? 'el-radio--' + radioSize : '',
            { 'is-disabled': isDisabled },
            { 'is-focus': focus },
            { 'is-bordered': border },
            { 'is-checked': model === label }
        ]"
        role="radio"
        :aria-checked="model === label"
        :aria-disabled="isDisabled"
        :tabindex="tabIndex"
        @keydown.space.stop.prevent="model = isDisabled ? model : label"
    >
        <span
            class="el-radio__input"
            :class="{
                'is-disabled': isDisabled,
                'is-checked': model === label
            }"
        >
            <span class="el-radio__inner"></span>
            <input
                class="el-radio__original"
                ref="radio"
                :value="label"
                type="radio"
                aria-hidden="true"
                v-model="model"
                @focus="focus = true"
                @click="handleClick"
                @change="handleChange"
                @blur="focus = false"
                :name="name"
                :disabled="isDisabled"
                tabindex="-1"
            />
        </span>
        <span class="el-radio__label" @keydown.stop>
            <slot></slot>
            <template v-if="!$slots.default">{{ label }}</template>
        </span>
    </label>
</template>

<script>
import { Radio } from 'element-ui';

export default {
    name: 'DgRadio',

    mixins: [Radio],

    props: {
        // 是否关闭再次点击取消功能
        callOff: Boolean
    },

    methods: {
        // create
        handleClick() {
            const bool = this.model === this.label;
            this.$emit('has-click', this.label);
            if (this.isGroup) {
              this.dispatch('ElRadioGroup', 'handleClick', this.label);
              this.dispatch('DgRadioGroup', 'handleClick', this.label);
            }
            // 如果前后值相等且关闭取消，则不让继续触发
            if (bool && this.callOff) {
                return;
            }
            const val = bool ? '' : this.label;
            this.$emit('input', val);
            this.$emit('change', val);
            // 兼容 <el-radio-group> & <dg-radio-group> 两种方式。注：这两种组件不能使用包含关系。
            if (this.isGroup) {
                this.dispatch('ElRadioGroup', 'handleChange', val);
                this.dispatch('DgRadioGroup', 'handleChange', val);
            }
        },

        // update
        handleChange() {
            this.$nextTick(() => {
                // 如果前后值相等则不让触发 change 事件
                if (this.model === this.label) {
                    return;
                }
                this.$emit('change', this.model);
                if (this.isGroup) {
                    this.dispatch('ElRadioGroup', 'handleChange', this.model);
                    this.dispatch('DgRadioGroup', 'handleChange', this.model); // lutz+
                }
            });
        }
    }
};
</script>
