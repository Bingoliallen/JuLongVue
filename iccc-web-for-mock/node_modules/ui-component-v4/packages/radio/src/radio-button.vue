<template>
  <label
          class="el-radio-button"
          :class="[
      size ? 'el-radio-button--' + size : '',
      { 'is-active': value === label },
      { 'is-disabled': isDisabled },
      { 'is-focus': focus }
    ]"
          role="radio"
          :aria-checked="value === label"
          :aria-disabled="isDisabled"
          :tabindex="tabIndex"
          @keydown.space.stop.prevent="value = isDisabled ? value : label"
  >
    <input
            class="el-radio-button__orig-radio"
            :value="label"
            type="radio"
            v-model="value"
            :name="name"
            @click="handleClick"
            @change="handleChange"
            :disabled="isDisabled"
            tabindex="-1"
            @focus="focus = true"
            @blur="focus = false"
    >
    <span
            class="el-radio-button__inner"
            :style="value === label ? activeStyle : null"
            @keydown.stop>
      <slot></slot>
      <template v-if="!$slots.default">{{label}}</template>
    </span>
  </label>
</template>
<script>
    import { RadioButton } from 'element-ui';

  export default {
    name: 'DgRadioButton',

    mixins: [RadioButton],

    props: {
        // 是否关闭再次点击取消功能
        callOff: Boolean
    },

    methods: {
        // create
        handleClick() {
            const bool = this.value === this.label;
            this.$emit('has-click', this.label);
            if (this.isGroup) {
              this.dispatch('ElRadioGroup', 'handleClick', this.label);
              this.dispatch('DgRadioGroup', 'handleClick', this.label);
            }
            // 如果前后值相等且关闭取消，则不让继续触发
            if (bool && this.callOff) {
                return;
            }
            const val = bool ? '' : this.label;
            this.$emit('input', val);
            this.$emit('change', val);
            // 兼容 <el-radio-group> & <dg-radio-group> 两种方式。注：这两种组件不能使用包含关系。
            if (this._radioGroup) {
                this.dispatch('ElRadioGroup', 'handleChange', val);
                this.dispatch('DgRadioGroup', 'handleChange', val);
            }
        },

        // update
        handleChange() {
            this.$nextTick(() => {
                // 如果前后值相等则不让触发 change 事件
                if (this.value === this.label) {
                    return;
                }
                this.$emit('change', this.value);
                if (this._radioGroup) {
                    this.dispatch('ElRadioGroup', 'handleChange', this.value);
                    this.dispatch('DgRadioGroup', 'handleChange', this.value);
                }
            });
        }
    }
  };
</script>
