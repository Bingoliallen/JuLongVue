<!--
    模板布局
    @Author: lkh
    @Date: 2019-10-30
-->
<template>
  <div class="theme-bg">
    <div class="theme-bg__box"></div>
    <div class="theme-cont">
      <div class="is-title">请选择系统主题</div>
      <div class="theme-cont__module">
        <div @click="handleClickChecked(item.url)" v-for="(item, index) in themeData" :key="index" class="is-module">
          <img :src="item.src" alt="" />
          <p>{{ item.name }}</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import gztApi from '../../api/gztApi';
export default {
  name: 'themeBg',
  data() {
    return {
      bjtpList: null,
      themeData: [
        {
          name: '简约风格',
          src: require('../../assets/images/dashboard/theme__simple.png'),
          url: '/themeSimple'
        },
        {
          name: '个性化风格',
          src: require('../../assets/images/dashboard/theme__selfdom.png'),
          url: '/themeSelfdom'
        }
      ]
    };
  },
  methods: {
    /**
     * 选择哪个主题
     * */
    handleClickChecked(url) {
      let param = {};
      let userConfig = {};
      try {
        userConfig = JSON.parse(sessionStorage.userConfig);
      } catch (er) {
        userConfig = {};
      }
      if (url == '/themeSimple') {
        param.bjtpid = userConfig.bjtpList[0].bjtpid;
        param.xtzt = 'JYFG';
        userConfig.dqxtzt = 'JYFG';
        userConfig.dqbjtpid = param.bjtpid;
      }
      if (url == '/themeSelfdom') {
        this.$dgConfirm('该主题建设中…', '提示', {
          showCancelButton: false,
          showConfirmButton: true,
          customClass: 'confirm_user',
          cancelButtonClass: 'btn-custom-cancel',
          confirmButtonClass: 'btn-custom-submit',
          closeOnClickModal: false,
          type: 'warning'
        });
        return;
        // eslint-disable-next-line no-unreachable
        param.bjtpid = userConfig.bjtpList[5].bjtpid;
        param.xtzt = 'GXFG';
        userConfig.dqxtzt = 'GXFG';
        userConfig.dqbjtpid = param.bjtpid;
      }
      sessionStorage.userConfig = JSON.stringify(userConfig);
      window.HOMEACCESS = userConfig;
      gztApi.saveXtztAndBjtp(param).then(res => {
        this.$router.push(url);
      });
    }
  },
  beforeRouteEnter(to, from, next) {
    let userConfig = {};
    try {
      userConfig = JSON.parse(sessionStorage.userConfig);
    } catch (er) {
      userConfig = {};
    }
    let dqxtzt = userConfig.dqxtzt;
    let path = dqxtzt == 'JYFG' ? '/themeSimple' : dqxtzt == 'GXFG' ? '/themeSelfdom' : '';
    if (path) {
      next({
        path: path,
        replace: true
      });
    } else {
      next();
    }
  }
};
</script>

<style scoped lang="scss">
@import 'index.scss';
</style>
