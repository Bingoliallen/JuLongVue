<!--预警规则配置-->
<template>
  <div class="warning-rule">
    <dg-button class="warning-rule-btn-add" type="primary" @click="editRule">添加</dg-button>
    <div class="warning-rule_content" v-if="ruleItems.length > 0">
      <div class="warning-rule_item" v-for="item in ruleItems" :key="item.prop">
        <div class="label">{{ item.label }}：</div>
        <div class="value">
          <div :class="item.prop">
            <dg-tag v-for="(tag, i) in item.value" :key="i" effect="plain" closable @close="handleClose(tag, i, item)">
              <template v-if="item.code">
                <qb-showlable :code="item.code" :values="tag" :module="module"></qb-showlable>
              </template>
              <template v-else-if="item.filter">{{ tag | filterAll(item.filter) }}</template>
              <template v-else>-</template>
            </dg-tag>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  // 预警规则配置
  name: 'warning-rule',
  props: {
    value: {
      type: Object,
      default() {
        return {};
      }
    },
    module: String
  },
  computed: {
    ruleItems() {
      const ruleItems = [
        { label: '轨迹类型', prop: 'gjlx', code: 'BM_QWBK_BKDX', module: this.module },
        { label: '目的地', prop: 'mdd', code: 'BM_QWBK_BKDX', module: this.module },
        { label: '活动地', prop: 'hdd', code: 'BM_QWBK_BKDX', module: this.module },
        { label: '区域防控', prop: 'qyfk', filter: 'qyfk' }
      ];
      return ruleItems
        .map(e => ({
          ...e,
          value: this.value[e.prop]
        }))
        .filter(e => e.value && e.value.length > 0);
    }
  },
  filters: {
    filterAll(val, method) {
      if (method === 'qyfk') {
        return `${val.JCFX === '1' ? '进入' : '离开'}  ${val.FKQMC}`;
      }
      return val;
    }
  },
  methods: {
    editRule() {},
    handleClose(tag, i, item) {
      item.value.splice(i, 1);
      this.changeValue(this.value);
    },
    changeValue(value) {
      this.$emit('input', value);
      this.$emit('change', value);
    }
  }
};
</script>

<style lang="scss" scoped>
.warning-rule {
  &-btn {
    &-add {
      margin-bottom: 1.25rem;
    }
  }
  &_content {
    display: table;
    width: 100%;
    background: var(--table-header-background-color);
    border: 1px dashed var(--border-color-extra-light);
    border-radius: 2px;
    padding: 1.5rem 1rem 0;
  }
  &_item {
    display: table-row;
    .label {
      display: table-cell;
      color: var(--color-text-secondary);
      text-align: right;
      width: 6em;
    }
    .value {
      display: table-cell;
      padding-left: 8px;
      padding-bottom: 1.5rem;
      /deep/ .el-icon-close {
        margin-left: 1em;
      }
      .qyfk {
        line-height: 2.5;
        margin-left: -8px;
        .dg-tag {
          margin-left: 8px;
        }
      }
    }
  }
}
</style>
