<template>
  <div class="yjjsr-transfer">
    <div class="yjjsr-transfer_btn">
      <dg-button type="text" @click="clearAll">清空已选接收人</dg-button>
    </div>
    <dg-transfer
      filterable
      :filter-method="filterMethod"
      :filter-placeholder="filterPlaceholder"
      :titles="titles"
      label-name="name"
      value-name="id"
      pid-name="pid"
      children-name="children"
      v-model="yjjsr"
      type="tree"
      :data="dataSource"
      :open-all="false"
    ></dg-transfer>
  </div>
</template>

<script>
import request from '@icccdPath/utils/request';

const { getSetting } = window.systemParamsUtils;
export default {
  name: 'yjjsr-transfer',
  props: {
    value: String,
    filterPlaceholder: String,
    leftTitle: String,
    rightTitle: String,
    module: String,
    // 翻译表码接口
    url: String,
    // 被选中项表码值
    data: String
  },
  data() {
    return {
      dataSource: []
    };
  },
  computed: {
    titles() {
      return [this.leftTitle || '', this.rightTitle || ''];
    },
    yjjsr: {
      get() {
        return (this.value || '').split(',');
      },
      set(val) {
        this.$emit('input', (val || []).join(','));
      }
    }
  },
  watch: {
    data(val) {
      if (!val) {
        this.dataSource = [];
        return;
      }
      this.fyBm(val);
    }
  },
  methods: {
    filterMethod(query, item) {
      return item.label.indexOf(query) !== -1;
    },
    clearAll() {
      this.yjjsr = [];
    },
    fyBm(codes) {
      // TODO: 调用接口，把 val 翻译成树结构，如果某一级被选中了，就把本级之上的都加载出来，本级之下的遍历成树加载出来
      const baseURL = getSetting(this.module);
      request({ baseURL, url: this.url, method: 'post', data: { codes } }).then(res => {
        this.dataSource = res.data;
      });
    }
  }
};
</script>

<style lang="scss">
.yjjsr-transfer {
  .el-transfer-panel:last-of-type {
    .el-transfer-panel__header {
      .el-checkbox__label {
        span {
          /*display: none;*/
        }
      }
    }
  }
}
</style>
