<!--
 * @Author: Liugh
 * @Date: 2021-01-01 14:21:33
 * @LastEditTime: 2021-01-02 15:10:14
 * @LastEditors: Do not edit
 * @Description: 
-->
<template>
  <el-input class="qs-translate" v-model="valueText" @change="change"></el-input>
</template>

<script>
import { getCodeDict } from '@icccdPath/api/common.js';
export default {
  name: 'qs-input', // 组件名称
  props: {
    // 接收父组件的数据
    value: String,
    module: String,
    code: String
  },
  data() {
    // 组件内部参数
    return {
      // 参数名称及默认值
      valueText: '',
      codeData: null
    };
  },
  computed: {}, // 计算属性
  watch: {
    value: {
      handler(val) {
        if (val) {
          this.init();
        }
      }
    }
  }, // 侦听器（扩展的计算属性）
  components: {}, // 注册局部组件
  methods: {
    async init() {
      if (this.codeData) {
        let codeVal = this.codeData.data.find(item => {
          return item.value == this.value;
        });
        if (codeVal) {
          this.valueText = codeVal.label;
        } else {
          this.valueText = this.value;
        }
        this.change(this.valueText);
      } else {
        if (this.value) {
          const code = await getCodeDict(this.code);
          if (code.data) {
            let codeVal = code.data.find(item => {
              return item.value == this.value;
            });
            if (codeVal) {
              this.valueText = codeVal.label;
            } else {
              this.valueText = this.value;
            }
            this.change(this.valueText);
          }
          this.codeData = code;
        }
      }
    },
    change(val) {
      this.$emit('input', val);
    }
  }, // 内部方法
  created() {
    this.init();
  } // 组件创建完成后
};
</script>
<style lang="scss" scoped></style>
