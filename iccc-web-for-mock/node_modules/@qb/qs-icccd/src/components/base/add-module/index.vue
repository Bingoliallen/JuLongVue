<template>
  <div class="add-module">
    <tabList :tabItemsData="tabItemsData" :curTabType="tabItemShow" @changeData="changeData($event)"></tabList>
    <!--本系统模块 begin-->
    <div v-if="tabItemShow == 0" class="module">
      <div class="al-module">
        <div class="title">已添加模块</div>
        <ul>
          <li v-for="(item, index) in preDataFilte" :key="index">
            <div class="dg-application-app">
              <div class="dg-application-app__box" :class="item.yybjys">
                <i class="dg-application-app__box--icon icon" :class="item.yytb"></i>
              </div>
              <p class="dg-application-app__box--text">{{ item.yymc }}</p>
            </div>
            <div class="dg-application-del" @click="delMyApp(item, index)"></div>
          </li>
        </ul>
      </div>
      <div class="al-module">
        <div class="title">未添加模块</div>
        <ul>
          <li v-for="(item, index) in alData" :key="index">
            <div class="dg-application-app">
              <div class="dg-application-app__box" :class="item.yybjys">
                <i class="dg-application-app__box--icon icon" :class="item.yytb"></i>
              </div>
              <p class="dg-application-app__box--text">{{ item.yymc }}</p>
            </div>
            <!-- <div class="dg-application-add" @click="addMyApp(item, index)" v-if="checkPermission([item.yybh])"></div> -->
            <div class="dg-application-add" @click="addMyApp(item, index)"></div>
          </li>
        </ul>
      </div>
    </div>
    <!--本系统模块 end-->

    <!--外部系统模块 begin-->
    <div v-if="tabItemShow == 1" style="margin-top: 1rem;">
      <el-form label-width="100px" ref="addApp" :model="outModuleData" :rules="Verification.indexAddApp">
        <el-form-item label="模块名称：" prop="yymc">
          <el-input placeholder="请输入模块名称" v-model="outModuleData.yymc" maxlength="4" show-word-limit></el-input>
        </el-form-item>
        <el-form-item label="模块URL：" prop="yyurl" class="url-input">
          <el-input
            placeholder="请输入模块访问地址URL"
            v-model="outModuleData.yyurl"
            maxlength="250"
            show-word-limit
            clearable
          ></el-input>
        </el-form-item>
        <el-form-item label="选择图标：">
          <div class="add-module-icon__box">
            <div
              @click="handleClickChecked(item, index)"
              v-for="(item, index) in outModuleSelectData"
              :key="index"
              :class="['is-app', item.appBgStyle, selectedOne == index ? 'is-active' : '']"
            >
              <i :class="['icon', item.appIcon]"></i>
            </div>
          </div>
        </el-form-item>
      </el-form>
    </div>
    <!--外部系统模块 end-->
  </div>
</template>

<script>
import tabList from '../tab-list/index';
import checkPermission from '@icccdPath/utils/permission'; // 权限判断函数
export default {
  name: 'addModule',
  components: { tabList },
  props: {
    myAppList: {
      type: Array,
      default: function() {
        return [];
      }
    },
    otherAppList: {
      type: Array,
      default: function() {
        return [];
      }
    },
    size: {
      type: [Number, String],
      default() {
        return 24;
      }
    }
  },
  computed: {
    preDataFilte() {
      return this.preData.filter(item => {
        return item.sfwbyy == 0 && item.yypx != 999;
      });
    }
  },
  data() {
    return {
      tabItemShow: 0,
      tabItemsData: [
        {
          type: 0,
          name: '本系统模块'
        },
        {
          type: 1,
          name: '外部系统模块'
        }
      ],
      preData: JSON.parse(JSON.stringify(this.myAppList)),
      alData: JSON.parse(JSON.stringify(this.otherAppList)),
      outModuleData: {
        listIndex: 0,
        sfwbyy: '1',
        yymc: '',
        yyurl: '',
        yypx: Date.now(),
        yytb: 'iconf-photo',
        yybjys: 'dg-application-app__bg1'
      },
      selectedOne: 0,
      isPreData: false,
      outModuleSelectData: [
        {
          appIcon: 'iconf-photo',
          appBgStyle: 'dg-application-app__bg1'
        },
        {
          appIcon: 'iconf-ie',
          appBgStyle: 'dg-application-app__bg2'
        },
        {
          appIcon: 'iconf-car',
          appBgStyle: 'dg-application-app__bg3'
        },
        {
          appIcon: 'iconf-maintain',
          appBgStyle: 'dg-application-app__bg4'
        },
        {
          appIcon: 'iconf-control',
          appBgStyle: 'dg-application-app__bg1'
        },
        {
          appIcon: 'iconf-monitor',
          appBgStyle: 'dg-application-app__bg2'
        },
        {
          appIcon: 'iconf-Earlywarning',
          appBgStyle: 'dg-application-app__bg3'
        },
        {
          appIcon: 'iconf-Approval',
          appBgStyle: 'dg-application-app__bg4'
        },
        {
          appIcon: 'iconf-statistics',
          appBgStyle: 'dg-application-app__bg1'
        },
        {
          appIcon: 'iconf-voice',
          appBgStyle: 'dg-application-app__bg2'
        },
        {
          appIcon: 'iconf-send',
          appBgStyle: 'dg-application-app__bg3'
        },
        {
          appIcon: 'iconf-team',
          appBgStyle: 'dg-application-app__bg4'
        }
      ]
    };
  },
  mounted() {
    this.isPreData = this.preData.length ? false : true;
    let list = [];
    this.preData.forEach(item => {
      list.push(Number(item.listIndex));
    });
    for (let i = 0; i < this.size; i++) {
      if (list.indexOf(i) == '-1') {
        this.outModuleData.listIndex = i;
        break;
      } else {
        if (list.indexOf(i) != '-1') {
          continue;
        }
      }
    }
  },
  methods: {
    checkPermission,
    /**
     * @func 系统模块切换方法
     * @param {object} obj - 被点击对象的数据
     */
    changeData(obj) {
      this.tabItemShow = obj.type;
      if (obj.type == 0) {
        // 点击为本部系统时
        this.preData = JSON.parse(JSON.stringify(this.myAppList));
        this.alData = JSON.parse(JSON.stringify(this.otherAppList));
      }
    },
    /**
     * @func 删除系统APP
     * @param {number} index - 被点击对象的下标
     * @param {object} item - 被点击对象的数据
     */
    delMyApp(item, index) {
      this.preData.splice(index, 1);
      item.isAdd = false;
      delete item.listIndex;
      this.alData.unshift(item);
      console.log(item);
    },
    /**
     * @func 添加系统APP
     * @param {number} index - 被点击对象的下标
     * @param {object} item - 被点击对象的数据
     */
    addMyApp(item, index) {
      this.alData.splice(index, 1);
      item.isAdd = true;
      let list = [];
      if (!this.isPreData) {
        this.preData.forEach((itemOne, indexOne) => {
          if (itemOne.yypx != 999) {
            list.push(Number(itemOne.listIndex));
          } else {
            this.preData.splice(indexOne, 1);
          }
        });
        for (let i = 0; i < this.size; i++) {
          if (!~list.indexOf(i)) {
            item.listIndex = i;
            this.preData.push(item);
            break;
          } else {
            if (~list.indexOf(i)) {
              continue;
            }
          }
        }
      } else {
        item.listIndex = 0;
        this.preData.push(item);
        this.isPreData = false;
      }
    },

    /**
     * @func 选择外部模块图标
     * @param {number} index - 被点击对象的下标
     * @param {object} item - 被点击对象的数据
     */
    handleClickChecked(item, index) {
      this.outModuleData.yytb = item.appIcon;
      this.outModuleData.yybjys = item.appBgStyle;
      let list = [];
      if (!this.isPreData) {
        this.preData.forEach(item => {
          list.push(Number(item.listIndex));
        });
        for (let i = 0; i < this.size; i++) {
          if (list.indexOf(i) == '-1') {
            this.outModuleData.listIndex = i;
            break;
          } else {
            if (list.indexOf(i) != '-1') {
              continue;
            }
          }
        }
      } else {
        this.outModuleData.listIndex = 0;
        this.isPreData = false;
      }
      this.selectedOne = index;
    }
  }
};
</script>

<style scoped lang="scss">
/*@import "index.scss";*/
</style>
